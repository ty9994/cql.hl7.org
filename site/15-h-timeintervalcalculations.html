<!DOCTYPE html>
<!-- saved from url=(0043)http://hl7.org/fhir/2016May/FHIRPath.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

  <title>Appendix H – Time Interval Calculation Examples</title>

  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="http://cql.hl7.org" name="author"/>

  <link rel="stylesheet" href="dist/fhir.css"/>
  <link rel="Prev" href="history.html"/>

    <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="dist/bootstrap.css"/>
  <link rel="stylesheet" href="dist/bootstrap-fhir.css"/>

    <!-- Project extras -->
  <link rel="stylesheet" href="dist/project.css"/>
  <link rel="stylesheet" href="dist/prism.css"/>
  <link rel="stylesheet" href="dist/pygments-manni.css"/>
	<link rel="stylesheet" href="dist/jquery-ui.css"/>
	<link rel="stylesheet" href="dist/cql.css"/>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- [if lt IE 9]>
  <script src="./assets/js/html5shiv.js"></script>
  <script src="./assets/js/respond.min.js"></script>
  <![endif] -->

    <!-- Favicons -->
  <link sizes="144x144" rel="apple-touch-icon-precomposed" href="dist/apple-touch-icon-144-precomposed.png"/>
  <link sizes="114x114" rel="apple-touch-icon-precomposed" href="dist/apple-touch-icon-114-precomposed.png"/>
  <link sizes="72x72" rel="apple-touch-icon-precomposed" href="dist/apple-touch-icon-72-precomposed.png"/>
  <link rel="apple-touch-icon-precomposed" href="dist/apple-touch-icon-57-precomposed.png"/>
  <link rel="shortcut icon" href="dist/favicon.png"/>

</head>
<body data-feedly-mini="yes">
	<div id="segment-header" class="segment">  <!-- segment-header -->
		<div class="container">  <!-- container -->
			<a id="logo" no-external="true" href="index.html"><img alt="Clinical Quality Language" src="dist/cql-logo.png" width="100" height="75"/> </a>
			<div id="hl7-status">
				<b>Clinical Quality Language Release 1</b>
			</div>

			<div id="hl7-nav">
				 <a id="hl7-logo" no-external="true" href="http://www.hl7.org/">
					<img height="75" alt="visit the hl7 website" width="100" src="dist/hl7-logo.png"/>
				</a>
			</div>
			<!--<div id="hl7-nav"><a id="hl7-logo" no-external="true" href="http://cql.hl7.org/search.cfm"><img alt="Search CQL" src="dist/search.png"/></a></div>-->
		</div>
		<div class="container">  <!-- container -->
	</div></div>  <!-- /segment-header -->

	<div id="segment-navbar" class="segment">  <!-- segment-navbar -->
		<div id="stripe"> </div>
		<div class="container">  <!-- container -->
   <!-- HEADER CONTENT -->


			<nav class="navbar navbar-inverse">
				<div class="container">
					<button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
						<span class="icon-bar"> </span>
						<span class="icon-bar"> </span>
						<span class="icon-bar"> </span>
					</button>
					<a class="navbar-brand hidden" href="index.html">CQL</a>
					<div class="nav-collapse collapse navbar-inverse-collapse">
						<ul class="nav navbar-nav">
              <li class = "dropdown">
				  <a href="index.html" class = "dropbtn">Documentation</a>
			  <div class = "dropdown-content">
				  <a href="01-introduction.html">Chapter 1 - Introduction</a>
				  <a href="02-authorsguide.html">Chapter 2 - Author's Guide</a>
				  <a href="03-developersguide.html">Chapter 3 - Developer's Guide</a>
				  <a href="04-logicalspecification.html">Chapter 4 - Logical Specification</a>
				  <a href="05-languagesemantics.html">Chapter 5 - Language Semantics</a>
				  <a href="06-translationsemantics.html">Chapter 6 - Translation Semantics</a>
				  <a href="07-physicalrepresentation.html">Chapter 7 - Physical Representation</a>
				  <a href="08-a-cqlsyntax.html">Appendix A - CQL Syntax Formal Specification</a>
				  <a href="09-b-cqlreference.html">Appendix B - CQL Reference</a>
				  <a href="10-c-referenceimplementations.html">Appendix C - Reference Implementations</a>
				  <a href="11-d-references.html">Appendix D - References</a>
				  <a href="12-e-acronyms.html">Appendix E - Acronyms</a>
				  <a href="13-f-glossary.html">Appendix F - Glossary</a>
				  <a href="14-g-formattingconventions.html">Appendix G - Conventions</a>
				  <a href="15-h-timeintervalcalculations.html">Appendix H - Time Interval Calculation Examples</a>
				  <a href="16-i-fhirpathtranslation.html">Appendix I - FHIRPath Function Translation</a>
				  <a href="17-j-listoftables.html">Appendix J - List Of Tables</a>
				  <a href="18-k-listoffigures.html">Appendix K - List Of Figures</a>
          <a href="19-l-cqlsyntaxdiagrams.html">Appendix L - CQL Syntax Diagrams</a>
			  </div>
			  </li>
        <li><a href="02-authorsguide.html">Author's Guide</a></li>
        <li><a href="03-developersguide.html">Developer's Guide</a></li>
        <li><a href="09-b-cqlreference.html">CQL Reference</a></li>
              <li><a href="grammar.html">Grammar</a></li>
			  <li><a href="elm.html">ELM</a></li>
			  <li><a href="examples.html">Examples</a></li>
              <li><a href="tests.html">Tests</a></li>
							<li><a href="downloads.html">Downloads</a></li>
              <li><a href="http://cql.hl7.org/history.html">Version History</a><!--current--></li>

						</ul>
					</div>  <!-- /.nav-collapse -->

          </div>  <!-- /.container -->
			</nav>  <!-- /.navbar -->


  <!-- /HEADER CONTENT -->
		</div>  <!-- /container -->
	</div>  <!-- /segment-navbar -->

	<div id="segment-content" class="segment">  <!-- segment-content -->
	<div class="container">  <!-- container -->
            <div class="row">
            	<div class="inner-wrapper">
  <!-- CONTENT CONTENT -->


<div class="col-9">

<!--ReleaseHeader--><p id="publish-box">Publication Build: This will be filled in by the publication tooling</p><!--EndReleaseHeader-->


<table class="colsi"><tbody><tr><td id="wg"><a href="http://www.hl7.org/special/committees/dss/index.cfm" _target="blank">Clinical Decision Support</a> Work Group</td><td id="fmm"><a href="http://hl7.org/fhir/versions.html#maturity">Maturity Level</a>: N/A</td><td id="ballot"><a href="http://hl7.org/fhir/versions.html#std-process">Standards Status</a>: <a style="padding-left: 3px; padding-right: 3px; color: black;" title="Unless otherwise specified explicitly, content on this page is informative.">Informative</a></td></tr></tbody></table>


	<h1>Appendix H – Time Interval Calculation Examples</h1>



	<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#calculating-duration-in-years">1. Calculating Duration in Years</a>
<ul class="sectlevel2">
<li><a href="#definition">1.1. Definition</a></li>
<li><a href="#examples">1.2. Examples</a></li>
<li><a href="#negative-examples">1.3. Negative Examples</a></li>
</ul>
</li>
<li><a href="#calculating-duration-in-months">2. Calculating Duration in Months</a>
<ul class="sectlevel2">
<li><a href="#definition-1">2.1. Definition</a></li>
<li><a href="#examples-1">2.2. Examples</a></li>
<li><a href="#negative-exapmles-1">2.3. Negative Examples</a></li>
</ul>
</li>
<li><a href="#calculating-duration-in-weeks">3. Calculating Duration in Weeks</a>
<ul class="sectlevel2">
<li><a href="#definition-2">3.1. Definition</a></li>
<li><a href="#examples-2">3.2. Examples</a></li>
</ul>
</li>
<li><a href="#calculating-duration-in-days">4. Calculating Duration in Days</a>
<ul class="sectlevel2">
<li><a href="#definition-3">4.1. Definition</a></li>
<li><a href="#examples-3">4.2. Examples</a></li>
<li><a href="#negative-examples-2">4.3. Negative Examples</a></li>
</ul>
</li>
<li><a href="#calculating-duration-in-hours">5. Calculating Duration in Hours</a>
<ul class="sectlevel2">
<li><a href="#definition-4">5.1. Definition</a></li>
<li><a href="#examples-4">5.2. Examples</a></li>
<li><a href="#negative-examples-3">5.3. Negative Examples</a></li>
</ul>
</li>
<li><a href="#calculating-duration-in-minutes">6. Calculating Duration in Minutes</a>
<ul class="sectlevel2">
<li><a href="#definition-5">6.1. Definition</a></li>
<li><a href="#examples-5">6.2. Examples</a></li>
<li><a href="#negative-examples-4">6.3. Negative Examples</a></li>
</ul>
</li>
<li><a href="#difference-calculations">7. Difference Calculations</a>
<ul class="sectlevel2">
<li><a href="#examples-6">7.1. Examples</a></li>
<li><a href="#negative-examples-5">7.2. Negative Examples</a></li>
</ul>
</li>
<li><a href="#interpreting-timing-phrases">8. Interpreting Timing Phrases</a>
<ul class="sectlevel2">
<li><a href="#same-as">8.1. Same as</a></li>
<li><a href="#relative-comparison">8.2. Relative comparison</a></li>
<li><a href="#direct-comparison-with-offsets">8.3. Direct comparison with offsets</a></li>
<li><a href="#relative-comparison-with-offsets">8.4. Relative comparison with offsets</a></li>
<li><a href="#interval-example-summary">8.5. Interval Example Summary</a></li>
<li><a href="#during-and-includes">8.6. During and includes</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>To determine the length of time between two dates, CQL provides two different approaches, <em>duration</em>, the number of whole periods between two dates, and <em>difference</em>, the number of period boundaries crossed between two dates.</p>
</div>
<div class="paragraph">
<p>The first approach, calculating the <em>duration</em>, determines the number of whole periods that occur between the two dates. Conceptually, the calculation is performed by considering the two dates on a timeline, and counting the number of whole periods that fit on that timeline between the two dates. For example:</p>
</div>
<div class="paragraph">
<p>Date 1: 2012-03-10<br/>
Date 2: 2013-03-10<br/>
Duration In Years: years between Date1 and Date2</p>
</div>
<div class="paragraph">
<p>The Duration In Years expression gives one year, because an entire year has passed between the two dates. Note that time is considered for the purposes of calculating the number of years:</p>
</div>
<div class="paragraph">
<p>DateTime 1: 2012-03-10 10:20:00<br/>
DateTime 2: 2013-03-10 09:20:00<br/>
Duration in Years: years between DateTime1 and DateTime2</p>
</div>
<div class="paragraph">
<p>This expression gives zero years, because the year has not passed until 10:20:00 on the day in the following year. To calculate the number of years, ignoring the time, extract the date from the datetime value:</p>
</div>
<div class="paragraph">
<p>DateTime 1: 2012-03-10 10:20:00<br/>
DateTime 2: 2013-03-10 09:20:00<br/>
Duration In Years: years between (date from DateTime1) and (date from DateTime2)</p>
</div>
<div class="paragraph">
<p>The second approach, calculating the <em>difference</em>, determines the number of boundaries crossed between two dates. To illustrate the difference, consider the following example:</p>
</div>
<div class="paragraph">
<p>Date 1: 2012-12-31<br/>
Date 2: 2013-01-01<br/>
Duration In Years: years between Date1 and Date2<br/>
Difference In Years: difference in years between Date1 and Date2</p>
</div>
<div class="paragraph">
<p>The Duration In Years expression returns zero because a full year has not passed between the two dates. However, the Difference In Years expression returns 1 because one year boundary was crossed between the two dates.</p>
</div>
<div class="quoteblock note-info">
<blockquote>
<div class="paragraph">
<p>Durations above seconds are calendar durations that are not comparable with definite quantity UCUM duration units</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>In addition to duration and difference calculations, CQL provides timing phrases to allow flexible and precise natural language comparisons of date and time values and intervals. The available timing phrases in CQL fall into four categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>same as</code></p>
</li>
<li>
<p><code>before</code> and <code>after</code></p>
</li>
<li>
<p><code>within</code></p>
</li>
<li>
<p><code>during</code> and <code>includes</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following sections provide detailed examples of calculating duration and difference, as well as interpreting timing phrases of CQL.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-years"><a class="anchor" href="#calculating-duration-in-years"></a>1. Calculating Duration in Years</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition"><a class="anchor" href="#definition"></a>1.1. Definition</h3>
<div class="paragraph">
<p>In CQL, a <em>year</em> is defined as the duration of any time interval which starts at a certain time of day at a certain calendar date of the calendar year and ends at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The same time of day on the same calendar date of the next calendar year, if it exists</p>
</li>
<li>
<p>The same time of day on the immediately following calendar date of the next calendar year, if the same calendar date of the next calendar year does not exist.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note:</strong> When in the next calendar year the same calendar date does not exist, the ISO states that the ending calendar day has to be agreed upon. The above convention is used in CQL as a resolution to this issue.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples"><a class="anchor" href="#examples"></a>1.2. Examples</h3>
<div class="sect3">
<h4 id="scenario-1"><a class="anchor" href="#scenario-1"></a>1.2.1. Scenario 1</h4>
<div class="paragraph">
<p>When month (date 2) &lt; month (date 1):<br/>
Duration (years) = year (date 2) - year (date 1) - 1</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong><br/>
Date 1: 2012-<strong>03</strong>-10 22:05:09<br/>
Date 2: 2013-<strong>02</strong>-18 19:10:03<br/>
Duration = year (date 2) - year (date 1) - 1 = 2013 - 2012 - 1 = <strong>0 years</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="scenario-2"><a class="anchor" href="#scenario-2"></a>1.2.2. Scenario 2</h4>
<div class="paragraph">
<p>When month (date 2) = month (date 1) and day (date 2) &gt;= day (date 1)<br/>
Duration (years) = year (date 2) - year (date 1)</p>
</div>
<div class="paragraph">
<p><strong>Example 2.a:</strong> day (date 1) = day (date 2)<br/>
Date 1: 2012-03-<strong>10</strong> 22:05:09<br/>
Date 2: 2013-03-<strong>10</strong> 22:05:09<br/>
Duration = year (date 2) - year (date 1) = 2013 - 2012 = <strong>1 year</strong></p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Time of day is important in this calculation. If the time of day of Date 2 were less than the time of day for Date 1, the duration of the time interval would be 0 years according to the definition.</p>
</div>
<div class="paragraph">
<p><strong>Example 2.b:</strong> day (date 2) &gt; day (date 1)<br/>
Date 1: 2012-03-<strong>10</strong> 22:05:09<br/>
Date 2: 2013-03-<strong>20</strong> 04:01:30<br/>
Duration = year (date 2) - year (date 1) = 2013 - 2012 = <strong>1 year</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="scenario-3"><a class="anchor" href="#scenario-3"></a>1.2.3. Scenario 3</h4>
<div class="paragraph">
<p>When month (date 2) = month (date 1) and day (date 2) &lt; day (date 1)<br/>
Duration (years) = year (date 2) - year (date 1) - 1</p>
</div>
<div class="paragraph">
<p><strong>Example 3.a:</strong><br/>
Date 1: 2012-02-<strong>20</strong><br/>
Date 2: 2014-02-<strong>10</strong><br/>
Duration = year (date 2) - year (date 1) - 1 = 2014 - 2012 - 1 = <strong>1 year</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="scenario-4"><a class="anchor" href="#scenario-4"></a>1.2.4. Scenario 4</h4>
<div class="paragraph">
<p>When month (date 2) &gt; month (date 1)<br/>
Duration (years) = year (date 2) - year (date 1)</p>
</div>
<div class="paragraph">
<p><strong>Example 4.a:</strong><br/>
Date 1: 2012-<strong>03</strong>-10 11:16:02<br/>
Date 2: 2013-<strong>08</strong>-15 21:34:16<br/>
Duration = year (date 2) - year (date 1) = 2013 - 2012 - <strong>1 year</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 4.b:</strong><br/>
Date 1: 2012-<strong>02</strong>-29 10:18:56<br/>
Date 2: 2014-<strong>02</strong>-28 19:02:34<br/>
Duration = year (date 2) - year (date 1) = 2014 - 2012 = <strong>2 years</strong></p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Because there is no February 29 in 2014, per the <a href="05-languagesemantics.html#datetime-arithmetic-1">Date and Time Arithmetic</a> section, the last day of the calendar month is used. Thus the number of years can only change when the date reaches February 28. (e.g. 2012-02-29 + <strong>1 year</strong> = 2013-02-28)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="negative-examples"><a class="anchor" href="#negative-examples"></a>1.3. Negative Examples</h3>
<div class="sect3">
<h4 id="scenario-5"><a class="anchor" href="#scenario-5"></a>1.3.1. Scenario 5</h4>
<div class="paragraph">
<p>When month (date 1) &lt; month (date 2)<br/>
Duration (years) = year (date 2) - year (date 1) + 1</p>
</div>
<div class="paragraph">
<p><strong>Example 5:</strong><br/>
Date 1: 2012-<strong>02</strong>-20 10:20:56<br/>
Date 2: 2011-<strong>03</strong>-19 19:16:02<br/>
Duration = year (date 2) - year (date 1) + 1 = 2011 - 2012 + 1 = <strong>0 years</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="scenario-6"><a class="anchor" href="#scenario-6"></a>1.3.2. Scenario 6</h4>
<div class="paragraph">
<p>When month (date 2) = month (date 1) and day (date 2) &lt;= day (date 1)<br/>
Duration (years) = year (date 2) - year (date 1)</p>
</div>
<div class="paragraph">
<p><strong>Example 6.a:</strong> day (date 1) = day (date 2)<br/>
Date 1: 2013-05-<strong>11</strong> 20:06:10<br/>
Date 2: 2012-05-<strong>11</strong> 20:06:10<br/>
Duration = year (date 2) - year (date 1) = 2012 - 2013 = <strong>-1 year</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 6.b:</strong> day (date 1) &gt; day (date 2)<br/>
Date 1: 2013-05-<strong>15</strong> 10:19:55<br/>
Date 2: 2012-05-<strong>10</strong> 12:20:25<br/>
Duration = year (date 2) - year (date 1) = 2012 - 2013 = <strong>-1 year</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="scenario-7"><a class="anchor" href="#scenario-7"></a>1.3.3. Scenario 7</h4>
<div class="paragraph">
<p>When month (date 2) = month (date 1) and day (date 2) &gt; day (date 1)<br/>
Duration (years) = year (date 2) - year (date 1) + 1</p>
</div>
<div class="paragraph">
<p><strong>Example 7:</strong><br/>
Date 1: 2013-03-<strong>20</strong> 05:01:30<br/>
Date 2: 2011-03-<strong>30</strong> 06:45:50<br/>
Duration = year (date 2) - year (date 1) + 1 = 2011 - 2013 + 1 = <strong>-1 year</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="scenario-8"><a class="anchor" href="#scenario-8"></a>1.3.4. Scenario 8</h4>
<div class="paragraph">
<p>When month (date 2) &lt; month (date 1)<br/>
Duration (years) = year (date 2) - year (date 1)</p>
</div>
<div class="paragraph">
<p><strong>Example 8.a:</strong><br/>
Date 1: 2014-<strong>08</strong>-12 09:10:15<br/>
Date 2: 2013-<strong>05</strong>-14 01:17:10<br/>
Duration = year (date 2) - year (date 1) = 2013 - 2014 = <strong>-1 year</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 8.b:</strong><br/>
Date 1: 2015-<strong>11</strong>-05 05:50:45<br/>
Date 2: 2013-<strong>03</strong>-29 11:01:05<br/>
Duration = year (date 2) - year (date 1) = 2013 - 2015 = <strong>-2 years</strong></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-months"><a class="anchor" href="#calculating-duration-in-months"></a>2. Calculating Duration in Months</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition-1"><a class="anchor" href="#definition-1"></a>2.1. Definition</h3>
<div class="paragraph">
<p>A month in CQL is defined as the duration of any time interval which starts at a certain time of day at a certain calendar day of the calendar month and ends at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The same time of day at the same calendar day of the ending calendar month, if it exists</p>
</li>
<li>
<p>The same time of day at the immediately following calendar date of the ending calendar month, if the same calendar date of the ending month in the ending year does not exist.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Notes:</strong> When in the next calendar year the same calendar date does not exist, the ISO states that the ending calendar day has to be agreed upon. The above convention is used in CQL as a resolution to this issue.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-1"><a class="anchor" href="#examples-1"></a>2.2. Examples</h3>
<div class="sect3">
<h4 id="scenario-1-2"><a class="anchor" href="#scenario-1-2"></a>2.2.1. Scenario 1</h4>
<div class="paragraph">
<p>When day (date 2) &gt;= day (date 1)<br/>
Duration (months) = (year (date 2) - year (date 1)) * 12 + (month (date 2) - month (date 1))</p>
</div>
<div class="paragraph">
<p><strong>Example 1.a:</strong><br/>
Date 1: 2012-03-<strong>01</strong> 14:05:45<br/>
Date 2: 2012-03-<strong>31</strong> 23:01:49<br/>
Duration = (year (date 2) - year (date 1)) * 12 + (month (date 2) - (month (date 1))<br/>
= (2012 - 2012) * 12 + (3 - 3) = <strong>0 months</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 1.b:</strong><br/>
Date 1: 2012-03-<strong>10</strong> 22:05:09<br/>
Date 2: 2013-06-<strong>30</strong> 13:00:23<br/>
Duration = (year (date 2) - year (date 1)) * 12 + (month (date 2) - (month date 1))<br/>
= (2013 - 2012) * 12 + (6 - 3) = 12 + 3 = <strong>15 months</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="scenario-2-2"><a class="anchor" href="#scenario-2-2"></a>2.2.2. Scenario 2</h4>
<div class="paragraph">
<p>When day (day 2) &lt; day (date 1)<br/>
Duration (months) = (year (date 2) - year (date 1)) * 12 + (month (date 2) - month (date 1)) - 1</p>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong><br/>
Date 1: 2012-03-<strong>10</strong> 22:05:09<br/>
Date 2: 2013-01-<strong>09</strong> 07:19:33<br/>
Duration = (year (date 2) - year (date 1)) * 12 + (month (date 2) - month (date 1)) - 1<br/>
= (2013 - 2012) * 12 + (1 - 3) - 1 = 12 - 2 - 1 = <strong>9 months</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="negative-exapmles-1"><a class="anchor" href="#negative-exapmles-1"></a>2.3. Negative Examples</h3>
<div class="sect3">
<h4 id="scenario-3-2"><a class="anchor" href="#scenario-3-2"></a>2.3.1. Scenario 3</h4>
<div class="paragraph">
<p>When day (date 2) &lt;= day (date 1)<br/>
Duration (months) = (year (date 2) - year (date 1)) * 12 + (month (date 2) - month (date 1))</p>
</div>
<div class="paragraph">
<p><strong>Example 3.a:</strong><br/>
Date 1: 2013-10-<strong>15</strong> 13:07:40<br/>
Date 2: 2013-10-<strong>02</strong> 10:13:59<br/>
Duration = (year (date 2) - year (date 1)) * 12 + (month (date 2) - month (date 1))<br/>
= (2013 - 2013) * 12 - (10 - 10) = <strong>0 months</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 3.b:</strong><br/>
Date 1: 2014-05-<strong>10</strong> 21:02:45<br/>
Date 2: 2013-01-<strong>08</strong> 11:13:06<br/>
Duration (months) = (year (date 2) - year (date 1)) * 12 + (month (date 2) - month (date 1))<br/>
= (2013 - 2014) * 12 + (1 - 5) = (-12) + (-4) = <strong>-16 months</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="scenario-4-2"><a class="anchor" href="#scenario-4-2"></a>2.3.2. Scenario 4</h4>
<div class="paragraph">
<p>When day (day 2) &gt; day (date 1)<br/>
Duration (months) = (year (date 2) - year (date 1)) * 12 + (month (date 2) - month (date 1)) + 1</p>
</div>
<div class="paragraph">
<p><strong>Example 4:</strong><br/>
Date 1: 2012-06-<strong>11</strong> 12:16:17<br/>
Date 2: 2011-08-<strong>21</strong> 05:48:02<br/>
Duration (months) = (year (date 2) - year (date 1)) * 12 + (month (date 2) - month (date 1)) + 1<br/>
= (2011 - 2012) * 12 + (8 - 6) + 1 = (-12) + (2) + 1 = <strong>-9 months</strong></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-weeks"><a class="anchor" href="#calculating-duration-in-weeks"></a>3. Calculating Duration in Weeks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition-2"><a class="anchor" href="#definition-2"></a>3.1. Definition</h3>
<div class="paragraph">
<p>In CQL, a week is defined as a duration of any time interval which starts at a certain time of day at a certain calendar day at a certain calendar week and ends at the same time of day at the same calendar day of the ending calendar week. In other words, a complete week is always seven days long.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-2"><a class="anchor" href="#examples-2"></a>3.2. Examples</h3>
<div class="paragraph">
<p>Duration = [date 2 - date 1 (days)] / 7</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong><br/>
Date 1: 2012-03-10 22:05:09<br/>
Date 2: 2012-03-20 07:19:33<br/>
Duration = [# days (month (date 1)) - day (date 1) + # days (month (date 1) + 1) + # days (month (date 1) + 2) + &#8230;&#8203; + # days (month (date 2) - 1) + day (date 2)] / 7<br/>
= (20 - 10) / 7 = 10 / 7 = <strong>1 week</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong><br/>
Date 1: 2013-05-26 23:06:11<br/>
Date 2: 2013-05-12 20:25:30<br/>
Duration = [# days (month (date 1)) - day (date 1) + # days (month (date 1) + 1) + # days (month (date 1) + 2) + &#8230;&#8203; + # days (month (date 2) - 1) + day (date 2)] / 7<br/>
= (12 - 26) / 7 = -14/7 = <strong>-2 weeks</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-days"><a class="anchor" href="#calculating-duration-in-days"></a>4. Calculating Duration in Days</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition-3"><a class="anchor" href="#definition-3"></a>4.1. Definition</h3>
<div class="paragraph">
<p>In CQL, a day is defined as a duration of any time interval which starts at a certain calendar day and ends at the next calendar day (1 second to 23 hours, 59 minutes, and 59 seconds).</p>
</div>
<div class="paragraph">
<p>The duration in days between two dates will generally be given by subtracting the start calendar date from the end calendar date, respecting the time of day between the two dates.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-3"><a class="anchor" href="#examples-3"></a>4.2. Examples</h3>
<div class="sect3">
<h4 id="scenario-1-3"><a class="anchor" href="#scenario-1-3"></a>4.2.1. Scenario 1</h4>
<div class="paragraph">
<p>When time (date 2) &lt; time (date 1)<br/>
Duration = [date 2 - date 1 (days)] - 1</p>
</div>
<div class="paragraph">
<p><strong>Example 1:</strong><br/>
Date 1: 2012-01-31 <strong>12:30:00</strong><br/>
Date 2: 2012-02-01 <strong>09:00:00</strong><br/>
Duration = 02-01 - 01-31 - 1 = <strong>0 days</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="scenario-2-3"><a class="anchor" href="#scenario-2-3"></a>4.2.2. Scenario 2</h4>
<div class="paragraph">
<p>When time (date 2) &gt;= time (date 1)<br/>
Duration = date 2 - date 1 (days)</p>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong><br/>
Date 1: 2012-01-31 <strong>12:30:00</strong><br/>
Date 2: 2012-02-01 <strong>14:00:00</strong><br/>
Duration = 02-01 - 01-31 = <strong>1 day</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="negative-examples-2"><a class="anchor" href="#negative-examples-2"></a>4.3. Negative Examples</h3>
<div class="sect3">
<h4 id="scenario-3-3"><a class="anchor" href="#scenario-3-3"></a>4.3.1. Scenario 3</h4>
<div class="paragraph">
<p>When time (date 2) &gt; time (date 1)<br/>
Duration = [date 2 - date 1 (days)] + 1</p>
</div>
<div class="paragraph">
<p><strong>Example 3:</strong><br/>
Date 1: 2011-12-05 <strong>05:00:00</strong><br/>
Date 2: 2011-12-04 <strong>08:45:00</strong><br/>
Duration = 12-04 - 12-05 + 1 = <strong>0 days</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="scenario-4-3"><a class="anchor" href="#scenario-4-3"></a>4.3.2. Scenario 4</h4>
<div class="paragraph">
<p>When time (date 2) &lt;= time (date 1)<br/>
Duration = date 2 - date 1 (days)</p>
</div>
<div class="paragraph">
<p><strong>Example 4:</strong><br/>
Date 1: 2011-12-05 <strong>05:00:00</strong><br/>
Date 2: 2011-12-04 <strong>01:30:00</strong><br/>
Duration = 12-04 - 12-05 = <strong>-1 day</strong></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-hours"><a class="anchor" href="#calculating-duration-in-hours"></a>5. Calculating Duration in Hours</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition-4"><a class="anchor" href="#definition-4"></a>5.1. Definition</h3>
<div class="paragraph">
<p>In CQL, an hour is defined as 60 minutes. The duration in hours between two dates is the number of minutes between the two dates, divided by 60. The result is truncated to the unit.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-4"><a class="anchor" href="#examples-4"></a>5.2. Examples</h3>
<div class="paragraph">
<p><strong>Example 1:</strong><br/>
Date 1: 2012-03-01 03:10:00<br/>
Date 2: 2012-03-01 05:09:00<br/>
Duration = <strong>1 hour</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong><br/>
Date 1: 2012-02-29 23:10:00<br/>
Date 2: 2012-03-01 00:10:00<br/>
Duration = <strong>1 hour</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 3:</strong><br/>
Date 1: 2012-03-01 03:10<br/>
Date 2: 2012-03-01 04:00<br/>
Duration = <strong>0 hours</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="negative-examples-3"><a class="anchor" href="#negative-examples-3"></a>5.3. Negative Examples</h3>
<div class="paragraph">
<p><strong>Example 4:</strong><br/>
Date 1: 2013-10-10 12:30:00<br/>
Date 2: 2013-10-10 08:40:00<br/>
Duration = <strong>-3 hours</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 5:</strong><br/>
Date 1: 2013-10-10 01:45:00<br/>
Date 2: 2013-10-09 23:45:00<br/>
Duration = <strong>-2 hours</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 6:</strong><br/>
Date 1: 2013-10-10 12:00:00<br/>
Date 2: 2013-10-10 11:30:00<br/>
Duration = <strong>0 hours</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="calculating-duration-in-minutes"><a class="anchor" href="#calculating-duration-in-minutes"></a>6. Calculating Duration in Minutes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="definition-5"><a class="anchor" href="#definition-5"></a>6.1. Definition</h3>
<div class="paragraph">
<p>In CQL, a minute is defined as 60 seconds. The duration in minutes between two dates is the number of seconds between the two dates, divided by 60. The result is truncated to the unit.</p>
</div>
</div>
<div class="sect2">
<h3 id="examples-5"><a class="anchor" href="#examples-5"></a>6.2. Examples</h3>
<div class="paragraph">
<p><strong>Example 1:</strong><br/>
Date 1: 2012-03-01 03:10:00<br/>
Date 2: 2012-03-01 05:20:00<br/>
Duration = <strong>130 minutes</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong><br/>
Date 1: 2012-02-29 23:10:00<br/>
Date 2: 2012-03-01 00:20:00<br/>
Duration = <strong>70 minutes</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="negative-examples-4"><a class="anchor" href="#negative-examples-4"></a>6.3. Negative Examples</h3>
<div class="paragraph">
<p><strong>Example 3:</strong><br/>
Date 1: 2012-12-30 08:40:00<br/>
Date 2: 2012-12-30 06:50:00<br/>
Duration = <strong>-110 minutes</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 4:</strong><br/>
Date 1: 2012-12-30 00:20:00<br/>
Date 2: 2012-12-29 22:00:00<br/>
Duration = <strong>-140 minutes</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="difference-calculations"><a class="anchor" href="#difference-calculations"></a>7. Difference Calculations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Difference calculations are performed by truncating the datetime values at the next precision, and then performing the corresponding duration calculation on the truncated values.</p>
</div>
<div class="paragraph">
<p>Implementations need to consider the calculation of the "difference between" two datetimes with different timezone offsets. There are multiple use cases when this might occur, but the most prevalent is likely due to Daylight Saving Time (DST).</p>
</div>
<div class="paragraph">
<p>To support the expected results in all cases, normalization of datetime values may be needed, depending on the precision used in the difference calculation. Normalization refers to adjustment of one or both of the two datetime values used in the difference calculation, if the timezone offsets are not the same, to a common timezone offset (namely, the timezone offset of the evaluation request timestamp).</p>
</div>
<div class="paragraph">
<p>When difference is calculated for hours or finer units, timezone offsets should be normalized prior to truncation to correctly consider real (actual elapsed) time. When difference is calculated for days or coarser units, however, the time components (including timezone offset) should be truncated without normalization to correctly reflect the difference in calendar days, months, and years.</p>
</div>
<div class="sect2">
<h3 id="examples-6"><a class="anchor" href="#examples-6"></a>7.1. Examples</h3>
<div class="paragraph">
<p><strong>Example 1:</strong><br/>
Date 1: 2012-03-01 03:10:00<br/>
Date 2: 2012-12-31 10:10:00<br/>
Difference (years) = Duration (years) between 2012-01-01 00:00:00 and 2012-01-01 00:00:00<br/>
Difference (years) = <strong>0</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 2:</strong><br/>
Date 1: 2012-12-31 03:10:00<br/>
Date 2: 2013-01-01 10:10:00<br/>
Difference (years) = Duration (years) between 2012-01-01 00:00:00 and 2013-01-01 00:00:00<br/>
Difference (years) = <strong>1</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 3:</strong><br/>
Date 1: 2016-10-10 09:00:00<br/>
Date 2: 2016-10-11 11:59:00<br/>
Difference (days) = Duration (days) between 2016-10-10 00:00:00 and 2016-10-11 00:00:00<br/>
Difference (days) = <strong>1</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 4:</strong><br/>
Date 1: 2016-10-10 09:00:00<br/>
Date 2: 2016-10-12 00:00:00<br/>
Difference (days) = Duration (days) between 2016-10-10 00:00:00 and 2016-10-12 00:00:00<br/>
Difference (days) = <strong>2</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 5:</strong><br/>
Date 1: 2017-03-12 01:12:05.1 (-05:00)<br/>
Date 2: 2017-03-12 03:22:27.6 (-04:00)<br/>
Date 2 (normalized): 2017-03-12 02:22:27.6 (-05:00)<br/>
Difference (hours) = Duration (hours) between 2017-03-12 01:00:00.0 (-05:00) and 2017-03-12 02:00:00.0 (-05:00)<br/>
On the day that DST goes into effect, one might compare<br/>
1:00am Eastern Standard Time (EST) 2017-03-12 01:00:00.0 (-05:00) to<br/>
3:00am Eastern Daylight Time (EDT) 2017-03-12 03:00:00.0 (-04:00)<br/>
Since time "springs forward" at 2:00am, only one hour of <em>real</em> time has elapsed.<br/>
To calculate the "difference in hours" as 1, the second time (3:00am EDT) is normalized to the first time&#8217;s offset (making it 2:00am EST).<br/>
The difference between 1:00am EST and 2:00am EST is clearly one hour.<br/>
In a clinical setting, recognizing this as only one hour (and not two, as the clock might suggest) is important.</p>
</div>
<div class="paragraph">
<p><strong>Example 6:</strong><br/>
Date 1: 2017-11-05 01:30:00.0 (-04:00)<br/>
Date 2: 2017-11-05 01:15:00.0 (-05:00)<br/>
Date 2 (normalized): 2017-11-05 02:15:00.0 (-04:00)<br/>
Difference (minutes) = Duration (minutes) between 2017-11-05 01:30:00.0 (-04:00) and 2017-11-05 02:15:00.0 (-04:00)<br/>
Similarly, when DST ends, one might compare 1:30am EDT to 1:15am EST.<br/>
If we did not respect timezone offsets, the difference would appear to be -15 minutes.<br/>
Again, to calculate the "difference in minutes" as 45, the second time (1:15am EST) is normalized to the first time&#8217;s offset (making it 2:15am EDT).<br/>
The difference between 1:30am EDT and 2:15am EDT is clearly 45 minutes.</p>
</div>
<div class="paragraph">
<p><strong>Example 7:</strong><br/>
Date 1: 2017-03-12 00:00:00.0 (-05:00)<br/>
Date 2: 2017-03-13 00:00:00.0 (-04:00)<br/>
Without normalization of the dates:<br/>
Difference (days) = Duration (days) between 2017-03-12 00:00:00.0 and 2017-03-13 00:00:00.0<br/>
In some cases, normalization prior to truncation may give unexpected results. Consider the "difference in days" between midnight (EST) on the day that DST goes into effect and midnight (EDT) the next day. One would expect that since the second date is the "next day" on the calendar, difference in days should be 1.<br/>
With normalization prior to truncation, the second date would become 11:00pm EST on the same day as the first date.<br/>
The difference in days would be 0, which is not the expected result.</p>
</div>
</div>
<div class="sect2">
<h3 id="negative-examples-5"><a class="anchor" href="#negative-examples-5"></a>7.2. Negative Examples</h3>
<div class="paragraph">
<p><strong>Example 8:</strong><br/>
Date 1: 2015-05-30 12:30:14<br/>
Date 2: 2015-01-05 01:14:45<br/>
Difference (years) = Duration (years) between 2015-01-01 00:00:00 and 2015-01-01 00:00:00<br/>
Difference (years) = <strong>0 years</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 9:</strong><br/>
Date 1: 2019-01-01 14:40:30<br/>
Date 2: 2018-12-31 13:30:45<br/>
Difference (years) = Duration (years) between 2019-01-01 00:00:00 and 2018:01:01 00:00:00<br/>
Difference (years) = <strong>-1 year</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 10:</strong><br/>
Date 1: 2013-05-30 12:15:15<br/>
Date 2: 2013-01-15 13:01:45<br/>
Difference (months) = Duration (months) between 2013-05-01 00:00:00 and 2013-01-01 00:00:00<br/>
Difference (months) = <strong>-4 months</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 11:</strong><br/>
Date 1: 2017-11-14 11:30:00<br/>
Date 2: 2017-11-12 13:00:00<br/>
Difference (days) = Duration (days) between 2017-11-14 00:00:00 and 2017-11-12 00:00:00<br/>
Difference (days) = <strong>-2 days</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 12:</strong><br/>
Date 1: 2011-06-29 15:45:59 (-5:00)<br/>
Date 2: 2011-06-29 13:30:12 (-4:00)<br/>
Date 2 (normalized): 2011-06-29 12:30:12 (-5:00)<br/>
Difference (hours) = Duration (hours) between 2011-06-29 15:00:00.0 and 2011-06-29 12:00:00.0<br/>
Difference (hours) = <strong>-3 hours</strong></p>
</div>
<div class="paragraph">
<p><strong>Example 13:</strong><br/>
Date 1: 2016-10-31 04:30:17 (-4:00)<br/>
Date 2: 2016-10-31 02:45:55 (-5:00)<br/>
Date 2 (normalized): 2016-10-31 03:45:55<br/>
Difference (minutes) = Duration (minutes) between 2016-10-31 04:30:00.0 and 2016-10-31 03:45:00.0<br/>
Difference (minutes) = <strong>-45 minutes</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interpreting-timing-phrases"><a class="anchor" href="#interpreting-timing-phrases"></a>8. Interpreting Timing Phrases</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="same-as"><a class="anchor" href="#same-as"></a>8.1. Same as</h3>
<div class="paragraph">
<p>To directly compare two date/time values, you can use the standard equality operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-30 = @2020-07-30
@2020-07-30 != @020-07-31</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, CQL also supports a <code>same as</code> timing phrase to support precision-based comparison of date/time values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-30 same as @2020-07-30</code></pre>
</div>
</div>
<div class="paragraph">
<p>When used without a precision specifier as in the above example, the <code>same as</code> timing phrase is the same as equality. Precision specifiers can be used to compare date/time values to a specific precision:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-30 same month as @2020-07-31</code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns true because the comparison only proceeds to the <code>month</code> precision.</p>
</div>
</div>
<div class="sect2">
<h3 id="relative-comparison"><a class="anchor" href="#relative-comparison"></a>8.2. Relative comparison</h3>
<div class="paragraph">
<p>To determine whether a date/time value is before or after another, CQL supports relative comparisons. As with equality, the standard relative comparison operators can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-30 &lt; @2020-07-31
@2020-07-31 &lt;= @2020-07-31</code></pre>
</div>
</div>
<div class="paragraph">
<p>These comparisons both return true because the date July 30th, 2020 is <em>before</em> July 31st, 2020, and July 31st is <em>on or before</em> July 31st. As with direct comparison, CQL supports the <code>before</code> and <code>after</code> keywords:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-30 before @2020-07-31 // equivalent to @2020-07-30 &lt; @2020-07-31
@2020-07-31 on or before @2020-07-31 // equivalent to @2020-02-31 &lt;= @2020-07-31</code></pre>
</div>
</div>
<div class="paragraph">
<p>When no precision specifier is provided, these phrases are equivalent to the standard relative comparison operators. To compare to a particular precision:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-30 before month of @2020-07-31</code></pre>
</div>
</div>
<div class="paragraph">
<p>This comparison returns false, because although July 30th is <em>before</em> July 31st, the comparison only proceeds to the <em>month</em> and the months are the same.</p>
</div>
</div>
<div class="sect2">
<h3 id="direct-comparison-with-offsets"><a class="anchor" href="#direct-comparison-with-offsets"></a>8.3. Direct comparison with offsets</h3>
<div class="paragraph">
<p>Timing phrases for comparison can also include an <em>offset</em>, which allows a <em>duration</em> to be considered as part of the comparison. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-01T09:30:00.0 1 hour before @2020-07-01T10:30:00.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns true because 9:30AM on July 1st is exactly 1 hour before 10:30AM on July 1st. Note that this usage is a <em>direct</em> comparison, not a relative comparison, so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-01T08:30:00.0 1 hour before @2020-07-01T10:30:00.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns false because 8:30AM on July 1st is more than 1 hour before 10:30AM on July 1st. To support relative comparison with offsets, include the <code>or more</code> or <code>or less</code> keywords:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-01T08:30:00.0 1 hour or more before @2020-07-01T10:30:00.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of this comparison is true.</p>
</div>
</div>
<div class="sect2">
<h3 id="relative-comparison-with-offsets"><a class="anchor" href="#relative-comparison-with-offsets"></a>8.4. Relative comparison with offsets</h3>
<div class="paragraph">
<p>When using <code>or less</code>, the comparison is evaluated by considering an interval:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-01T09:30:00.0 1 hour or less on or before @2020-07-01T10:30:00.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above comparison returns true because 9:30AM on July 1st, 2020 is 1 hour or less on or before 10:30AM on July 1st, 2020. This is equivalent to asking</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-01T09:30:00.0 &gt;= (@2020-07-01T10:30:00.0 - 1 hour)
  and @2020-07-01T09:30:00.0 &lt;= @2020-07-01T10:30:00.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some further examples using this timing phrase:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-01T09:29:59.999 1 hour or less on or before @2020-07-01T10:30:00.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example returns false because 9:29:59.999AM on July 1st, 2020 is just barely more than 1 hour before 10:30AM on July 1st, 2020.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-01T09:29:59.999 1 hour or less on or before hour of @2020-07-01T10:30:00.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the above example returns true because the comparison only proceeds to the hour, and the hour, 9, is 1 hour or less before the hour, 10.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-01T08:31:00.0 1 hour or less on or before @2020-07-01T10:30:00.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example returns false because 8:31AM is more than 1 hour before 10:30AM (even though it is 1 hour and 59 minutes before).</p>
</div>
<div class="paragraph">
<p>To illustrate this point another way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">hours between @2020-07-01T08:31:00.0 and @2020-07-01T10:30:00.0 &lt;= 1 // true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example returns true because the duration in hours between 8:31AM and 10:30 AM is less than or equal to 1 (even though there is 1 hour and 59 minutes between the two times, it&#8217;s still less than or equal to 1 and the duration calculation is only looking for full hours).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">difference in hours between @2020-07-01T08:31:00.0 and @2020-07-01T10:30:00.0 &lt;= 1 // false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example returns false, because in using the <code>difference</code> calculation, we are indicating that we are concerned with the number of boundaries crossed, rather than the number of full hours, and two hour boundaries have been crossed between 8:31AM and 10:30AM.</p>
</div>
<div class="paragraph">
<p>Looking at another example, this time using <code>after</code> and to the <code>day</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-12T10:00:00.0 1 day after day of @2020-07-11T10:00:00.0 // true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example returns true because the comparison only proceeds to the day, and July 12th, 2020 is exactly 1 day after July 11th 2020.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-11T23:59:59.999 1 day after day of @2020-07-11T10:00:00.0 // false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example returns false, again because the comparison only proceeds to the day, and July 11th, 2020 is the same day as July 11th, 2020, not the day after.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-07-13T00:00:00.0 1 day after day of @2020-07-11T10:00:00.0 // false</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally, the above example returns false because July 13th is <em>more than</em> 1 day after July 11th.</p>
</div>
<div class="paragraph">
<p>Looking at another example, this time using <code>or less before</code> and <code>weeks</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2019-09-23 42 weeks or less before @2020-07-13 // true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example returns true because September 23rd, 2019 is 42 weeks or less before July 13th, 2020.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2019-09-23T09:00:00.0 42 weeks or less before @2020-07-13T10:00:00.0 // false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding time into the comparison, the above example returns false, because 9:00AM on September 23rd is more than 42 weeks before July 13th 2020. Only 1 hour more, but still more.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2019-09-23T09:00:00.0 42 weeks or less before day of @2020-07-13T10:00:00.0 // true</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the above example returns true, because the comparison only proceeds to the day, September 23rd 2019 is 42 weeks before July 13th 2020, again because the time components are not considered in the comparison.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2019-09-22T11:00:00.0 42 weeks or less before day of @2020-07-13T10:00:00.0 // false</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally, the above example returns false, because the comparison proceeds to the day, and September 22nd 2019 is 1 day more than 42 weeks before July 13th 2020.</p>
</div>
</div>
<div class="sect2">
<h3 id="interval-example-summary"><a class="anchor" href="#interval-example-summary"></a>8.5. Interval Example Summary</h3>
<div class="paragraph">
<p>The following table provides a summary of the timing phrase examples:</p>
</div>
<table id="table-h-a" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scenario: OneHourOrLessOnOrBefore</th>
<th class="tableblock halign-left valign-top">Calculation Type</th>
<th class="tableblock halign-left valign-top">CQL Timing Phrase</th>
<th class="tableblock halign-left valign-top">Result</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">Start: @2020-07-01T08:31:00.0<br/>
End: @2020-07-01T10:30:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@2020-07-01T08-08:31:00.0 1 hour <strong>or less</strong> on or before @2020-07-01T10:30:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keyword <code>or less</code> is used<br/>
Interval calculation is used, and the time difference is 1 hour and 59 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hours <strong>between</strong> @2020-07-01T08:31:00.0 and @2020-07-01T10:30:00.0 &#8656; 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keyword <code>between</code> is used<br/>
Duration calculation is used and the hours are rounded down to the closest hour</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Difference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>difference</strong> in hours between @2020-07-01T08:31:00.0 and @2020-07-01T10:30:00.0 &#8656; 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keyword <code>difference</code> is used<br/>
Difference calculation is used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">Start: @2020-07-01T09:29:59.999<br/>
End: @2020-07-01T10:30:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@2020-07-01T09:29:59.999 1 hour <strong>or less</strong> on or before @2020-07-01T10:30:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result of calculation is 1 hour and 1 millisecond</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">hours <strong>between</strong> @2020-07-01T09:29:59.999 and @2020-07-01T10:30:00.0 &#8656; 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keyword <code>between</code> is used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Difference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>difference</strong> in hours between @2020-07-01T09:29:59.999 and @2020-07-01T10:30:00.0 &#8656; 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keyword <code>difference</code> is used</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Table H-A - Timing phrase examples (hours)</p>
</div>
<table id="table-h-b" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scenario: OneDayAfterDayOf</th>
<th class="tableblock halign-left valign-top">Calculation Type</th>
<th class="tableblock halign-left valign-top">Timing Phrase</th>
<th class="tableblock halign-left valign-top">Result</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start: @2020-07-12T10:00:00.0<br/>
End: @2020-07-11T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@2020-07-12T10:00:00.0 1 day after day of @2020-07-11T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True since calculation = 24 hours = 1 day. The keyword <code>day of</code> sets precision to <code>day</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start: @2020-07-12T08:00:00.0<br/>
End: @2020-07-11T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@2020-07-12T08:00:00.0 1 day after day of @2020-07-11T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True since the calculation &lt; 24 hours but crossing one day = 1 day. The keyword <code>day of</code> sets precision to <code>day</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start: @2020-07-12T23:59:59.999<br/>
End: @2020-07-11T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@2020-07-12T23:59:59.999 1 day after day of @2020-07-11T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True since the calculation &gt; 24 hours and crossing one day = 1 day. The keyword <code>day of</code> sets precision to <code>day</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start: @2020-07-11T23:59:59.999<br/>
End: @2020-07-11T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@2020-07-011T23:59:59.999 1 day after day of @2020-07-11T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False since the dates are the same day, calculation = 0 days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start: @2020-07-13T00:00:00.0<br/>
End: @2020-07-11T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comparison</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@2020-07-13T00:00:00.0 1 day after day of @2020-07-11T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False since 7/11 to 7/13 = 2 days</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Table H-B - Timing phrase examples (days)</p>
</div>
<table id="table-h-c" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scenario: FortyTwoWeeksOrLessBefore</th>
<th class="tableblock halign-left valign-top">Calculation Type</th>
<th class="tableblock halign-left valign-top">Timing Phrase</th>
<th class="tableblock halign-left valign-top">Result</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start: @2019-09-23<br/>
End: @2020-07-13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@2019-09-23 42 weeks or less before @2020-07-13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True since calculation = 42 weeks. Data only has date, but no time, so the precision is <code>day</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Start: @2019-09-23T09:00:00.0<br/>
End: @2020-07-13T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@2019-09-23T09:00:00.0 42 weeks or less before @2020-07-13T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False since time is added to data, time precision is used and calculation = 42 weeks and 1 hour fails</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@2019-09-23T09:00:00.0 42 weeks or less before <strong>day of</strong> @2020-07-13T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True since <code>day of</code> is setting the precision to <code>day</code>, 42 weeks 1 hour = 24 weeks 0 days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start: @2019-09-22T11:00:00.0<br/>
End: @2020-07-13T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@2019-09-22T11:00:00.0 42 weeks or less before day of @2020-07-13T10:00:00.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False since calculation = 42 weeks and 1 day</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Table H-C - Timing phrase examples (weeks)</p>
</div>
<table id="table-h-d" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CQL Syntax</th>
<th class="tableblock halign-left valign-top">CQL Calculation Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A starts (ends) <strong>before</strong> start (end) of B<br/>
A starts (ends) <strong>after</strong> start (end) of B<br/>
A starts (ends) 3 days (weeks, hours) <strong>or more</strong> before start (end) of B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comparison</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A starts (ends) 3 days (weeks, hours) <strong>or less</strong> before start (end) of B<br/>
A starts (ends) <strong>within</strong> 3 days (weeks, hours) of start (end) of B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A starts (ends) 3 days (weeks, hours) <strong>before</strong> start (end) of B<br/>
A starts (ends) 3 days (weeks, hours) <strong>after</strong> start (end) of B<br/>
days (weeks, hours) <strong>between</strong> A and B<br/>
<strong>duration in</strong> days (weeks, hours) between A and B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>difference</strong> in days (weeks, hours) <strong>between</strong> A and B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Difference</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Table H-D - Timing phrase interpretation summary</p>
</div>
</div>
<div class="sect2">
<h3 id="during-and-includes"><a class="anchor" href="#during-and-includes"></a>8.6. During and includes</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cql" data-lang="cql">@2020-01-01T00:00:00.0 during Interval[@2020-01-01T00:00:00.0, @2020-01T10:30:00.00]
@2020-01-01T10:30:00.0 during Interval[@2020-01-01T00:00:00.0, @2020-01T10:30:00.00]</code></pre>
</div>
</div>
<div class="paragraph">
<p>These examples return true because during is defined inclusively.</p>
</div>
</div>
</div>
</div>


</div>


				</div>  <!-- /inner-wrapper -->
            </div>  <!-- /row -->
        </div>  <!-- /container -->

    </div>  <!-- /segment-content -->


	<div id="segment-footer" class="segment">  <!-- segment-footer -->
		<div class="container">  <!-- container -->
			<div class="inner-wrapper">
				<p>
        &copy; HL7.org 2014+. CQL (Release) (<a href="http://www.hl7.org/Special/committees/dss/index.cfm">Clinical Decision Support WG</a>). hl7.cql#1.5.2 generated on 2023-01-20 11:08:31 +1100
        <span style="color: #FFFF77">|
<!--               <a style="color: #81BEF7" href="http://services.w3.org/htmldiff?doc1=http%3A%2F%2Fcql.hl7.org%2FSTU2%2F<%rellink%>&amp;doc2=<%baseURL%><%rellink%>">Compare to STU2</a> | -->
               <a style="color: #81BEF7" rel="license" href="license.html">License</a> |
               <a style="color: #81BEF7" rel="history" href="http://cql.hl7.org/history.html">Version History</a> |
               <a style="color: #81BEF7" target="_blank" href="https://jira.hl7.org/issues">Propose a change</a>
        </span>
        </p>
			</div>  <!-- /inner-wrapper -->
		</div>  <!-- /container -->
	</div>  <!-- /segment-footer -->

	<div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
		<div class="container">  <!-- container -->
		</div>  <!-- /container -->
	</div>  <!-- /segment-post-footer -->

      <!-- JS and analytics only. -->
      <!-- Bootstrap core JavaScript
================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
<script src="dist/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
<script src="dist/bootstrap.min.js"> </script>
<script src="dist/respond.min.js"> </script>
<script src="dist/fhir.js"> </script>
<script src="dist/sidebar.js"> </script>
<script src="dist/prism.js"> </script>
<script src="dist/cql.js"> </script>

  <!-- Analytics Below
================================================== -->


<div id="feedly-mini" title="feedly Mini tookit"></div></body></html>
